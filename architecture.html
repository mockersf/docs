<!DOCTYPE html>
<html>
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-60508041-1"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60508041-1');
</script>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>Architecture - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
  </head>
  <body>
    <div class="top-logo">
  <a href="/">Concourse</a>
</div>

<nav class="top-nav">
  
  <a href="docs.html">Docs</a>
  
  <a href="download.html">Download</a>
  
  <a href="project.html" class="active">Project</a>
  
  <a href="community.html">Community</a>
  
  <a href="learning.html">Learning</a>
  
</nav>

<div class="top-search">
  <div id="search"></div>
</div>

<script type="text/javascript">
  Elm.Main.init({
    node: document.getElementById('search')
  });
</script>

    <div class="page-nav">
      







  

  
  <div class="context">
    <nav>
      <div class="top">
        
        <span class="section-number">3</span>
        
        
  <a href="project.html"  class="active">Project</a>

      </div>

      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="right">3.1&nbsp;</td>
            
            <td class="title-cell">
  <a href="contribute.html" >Contribute</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">3.2&nbsp;</td>
            
            <td class="title-cell">
  <a href="architecture.html"  class="self">Architecture</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">3.3&nbsp;</td>
            
            <td class="title-cell">
  <a href="thanks.html" >Thanks!</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">3.4&nbsp;</td>
            
            <td class="title-cell">
  <a href="trademarks.html" >Trademarks</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  





<div class="context">
  <div class="page-toc">
    <nav>
      <div class="top">
        
        <span class="section-number">3.2</span>
        
        
  <a href="architecture.html"  class="self">Architecture</a>

      </div>

      
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="architecture.html#component-atc">ATC: web UI &amp; build scheduler</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="architecture.html#component-tsa">TSA: worker registration &amp; forwarding</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="architecture.html#architecture-worker">Workers: container runtime &amp; cache management</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="architecture.html#component-garden">Garden: container orchestration</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="architecture.html#component-baggageclaim">BaggageClaim: volume management</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="architecture.html#internals">Internals</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="right">3.2.4.1&nbsp;</td>
        
        <td class="title-cell">
          <a href="database-schema.html">Database Schema</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="database-schema.html#pipelineapi-objects">Pipeline/API Objects</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="database-schema.html#abstract-objects">Abstract Objects</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="database-schema.html#runtime">Runtime</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="right">3.2.4.2&nbsp;</td>
        
        <td class="title-cell">
          <a href="garbage-collection.html">Garbage Collection</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="garbage-collection.html#goals">Goals</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="garbage-collection.html#how-it-works">How it Works</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="garbage-collection.html#container-collection">Container Collection</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="garbage-collection.html#volume-collection">Volume Collection</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="right">3.2.4.3&nbsp;</td>
        
        <td class="title-cell">
          <a href="volume-internals.html">Volumes</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="volume-internals.html#volume-lifecycle">Lifecycle</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="volume-internals.html#types-of-volumes">Types of Volumes</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="right">3.2.4.4&nbsp;</td>
        
        <td class="title-cell">
          <a href="container-internals.html">Containers</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="container-internals.html#container-lifecycle">Lifecycle</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="container-internals.html#types-of-containers">Types of Containers</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="container-internals.html#task-containers">Task Containers</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="container-internals.html#resource-check-container">Resource Check Container</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="container-internals.html#resource-get-container">Resource Get Container</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="right">3.2.4.5&nbsp;</td>
        
        <td class="title-cell">
          <a href="worker-internals.html">Workers</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="worker-internals.html#worker-lifecycle">Lifecycle</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="right">3.2.4.6&nbsp;</td>
        
        <td class="title-cell">
          <a href="caching-and-retention.html">Caching &amp; Retention</a>

          
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="caching-and-retention.html#build-retention">Build Retention</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="caching-and-retention.html#resource-retention">Resource Retention</a>

          
        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
  </table>
</div>

        </td>
      </tr>
    
  </table>
</div>

    </nav>
  </div>
</div>




    </div>

    <div class="page-aside"></div>

    <div class="page-content">
      <div class="section" id="section_architecture">
  
  <h1 class="section-header"><a class="anchor" name="architecture" href="#architecture"></a><span class="section-number">3.2 </span>Architecture</h1>
  

  <p>Concourse is a fairly simple distributed system built up from the following components. You&#39;ll see them referenced here and there throughout the documentation, so you may want to skim this page just to get an idea of what they are.</p><p><div class="tutorial-image">
  <img src="images/concourse_architecture.png" alt="tutorial image" />
</div></p>

  
    
      <div class="section" id="section_component-atc">
  
  <h2 class="section-header"><a class="anchor" name="component-atc" href="#component-atc"></a>ATC: web UI &amp; build scheduler</h2>
  

  <p>The ATC is the heart of Concourse. It runs the web UI and API and is responsible for all pipeline scheduling. It connects to PostgreSQL, which it uses to store pipeline data (including build logs).</p><p>Multiple ATCs can be running as one cluster; as long as they&#39;re all pointing to the same database, they&#39;ll synchronize using basic locking mechanisms and roughly spread work across the cluster.</p><p>The ATC by default listens on port <code>8080</code>, and is usually colocated with the <a href="architecture.html#component-tsa">TSA</a> and sitting behind a load balancer.</p><p><strong>Note:</strong> for <a href="builds.html#fly-intercept"><code>fly intercept</code></a> to function, make sure your load balancer is configured to do TCP or SSL forwarding, not HTTP or HTTPS.</p>

  
    
  
</div>
    
      <div class="section" id="section_component-tsa">
  
  <h2 class="section-header"><a class="anchor" name="component-tsa" href="#component-tsa"></a>TSA: worker registration &amp; forwarding</h2>
  

  <p>The TSA is a custom-built SSH server that is used solely for securely registering <a href="architecture.html#architecture-worker">workers</a> with the <a href="architecture.html#component-atc">ATC</a>.</p><p>The TSA only supports two commands: <code>register-worker</code> and <code>forward-worker</code>.</p><p>The <code>register-worker</code> command is used to register a worker directly with the ATC. This should be used if the worker is running in the same (private) network as the ATC.</p><p>The <code>forward-worker</code> command is used to reverse-tunnel a worker&#39;s addresses through the TSA and register the forwarded connections with the ATC. This allows workers running in arbitrary networks to register securely, so long as they can reach the TSA. This is much safer than opening the worker up to the outside world.</p><p>The TSA by default listens on port <code>2222</code>, and is usually colocated with the <a href="architecture.html#component-atc">ATC</a> and sitting behind a load balancer.</p>

  
    
  
</div>
    
      <div class="section" id="section_architecture-worker">
  
  <h2 class="section-header"><a class="anchor" name="architecture-worker" href="#architecture-worker"></a>Workers: container runtime &amp; cache management</h2>
  

  <p>Workers are machines running <a href="https://github.com/cloudfoundry-incubator/garden">Garden</a> and <a href="https://github.com/concourse/baggageclaim">Baggageclaim</a> servers and registering themselves via the <a href="architecture.html#component-tsa">TSA</a>.</p><p>Workers have no important state configured on their machines, as everything runs in a container and thus shouldn&#39;t care about what packages are installed on the host (well, except for those that allow it to be a worker in the first place). This is very different from workers in other non-containerized CI solutions, where the state of packages on the worker is crucial to whether your pipeline works or not.</p><p>Each worker registers itself with the Concourse cluster via the <a href="architecture.html#component-tsa">TSA</a>.</p><p>Workers by default listen on port <code>7777</code> for Garden and port <code>7788</code> for Baggageclaim. If they are within a private network reachable by the <a href="architecture.html#component-atc">ATC</a>, they&#39;ll probably bind on all addresses (<code>0.0.0.0</code>) and register themselves directly. Otherwise they should bind on <code>127.0.0.1</code> and forward themselves through the <a href="architecture.html#component-tsa">TSA</a>.</p>

  
    
      <div class="section" id="section_component-garden">
  
  <h3 class="section-header"><a class="anchor" name="component-garden" href="#component-garden"></a>Garden: container orchestration</h3>
  

  

  
    
  
</div>
    
      <div class="section" id="section_component-baggageclaim">
  
  <h3 class="section-header"><a class="anchor" name="component-baggageclaim" href="#component-baggageclaim"></a>BaggageClaim: volume management</h3>
  

  

  
    
  
</div>
    
  
</div>
    
      <div class="section" id="section_internals">
  
  <h2 class="section-header"><a class="anchor" name="internals" href="#internals"></a>Internals</h2>
  

  
<ol class="toc">

  <li><span class="section-number">3.2.4.1 </span><a href="database-schema.html">Database Schema</a>

    
<ol class="toc">

  <li><a href="database-schema.html#pipelineapi-objects">Pipeline/API Objects</a>

    
  </li>

  <li><a href="database-schema.html#abstract-objects">Abstract Objects</a>

    
  </li>

  <li><a href="database-schema.html#runtime">Runtime</a>

    
  </li>

</ol>

  </li>

  <li><span class="section-number">3.2.4.2 </span><a href="garbage-collection.html">Garbage Collection</a>

    
<ol class="toc">

  <li><a href="garbage-collection.html#goals">Goals</a>

    
  </li>

  <li><a href="garbage-collection.html#how-it-works">How it Works</a>

    
<ol class="toc">

  <li><a href="garbage-collection.html#container-collection">Container Collection</a>

    
  </li>

  <li><a href="garbage-collection.html#volume-collection">Volume Collection</a>

    
  </li>

</ol>

  </li>

</ol>

  </li>

  <li><span class="section-number">3.2.4.3 </span><a href="volume-internals.html">Volumes</a>

    
<ol class="toc">

  <li><a href="volume-internals.html#volume-lifecycle">Lifecycle</a>

    
  </li>

  <li><a href="volume-internals.html#types-of-volumes">Types of Volumes</a>

    
  </li>

</ol>

  </li>

  <li><span class="section-number">3.2.4.4 </span><a href="container-internals.html">Containers</a>

    
<ol class="toc">

  <li><a href="container-internals.html#container-lifecycle">Lifecycle</a>

    
  </li>

  <li><a href="container-internals.html#types-of-containers">Types of Containers</a>

    
<ol class="toc">

  <li><a href="container-internals.html#task-containers">Task Containers</a>

    
  </li>

  <li><a href="container-internals.html#resource-check-container">Resource Check Container</a>

    
  </li>

  <li><a href="container-internals.html#resource-get-container">Resource Get Container</a>

    
  </li>

</ol>

  </li>

</ol>

  </li>

  <li><span class="section-number">3.2.4.5 </span><a href="worker-internals.html">Workers</a>

    
<ol class="toc">

  <li><a href="worker-internals.html#worker-lifecycle">Lifecycle</a>

    
  </li>

</ol>

  </li>

  <li><span class="section-number">3.2.4.6 </span><a href="caching-and-retention.html">Caching &amp; Retention</a>

    
<ol class="toc">

  <li><a href="caching-and-retention.html#build-retention">Build Retention</a>

    
  </li>

  <li><a href="caching-and-retention.html#resource-retention">Resource Retention</a>

    
  </li>

</ol>

  </li>

</ol>


  
</div>
    
  
</div>

      <nav class="prev-next">
      
        <div class="prev">
          prev:

          
          <span class="section-number">3.1</span>
          

          <a href="contribute.html">Contribute</a>
        </div>
      

      
        <div class="next">
          next:

          
          <span class="section-number">3.3</span>
          

          <a href="thanks.html">Thanks!</a>
        </div>
      
      </nav>
    </div>

    <ul class="improve-docs">
      <li><img src="images/github.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>