<!DOCTYPE html>
<html>
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-60508041-1"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60508041-1');
</script>

<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>Global Resources (experimental) - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
  </head>
  <body>
    <div class="top-logo">
  <a href="/">Concourse</a>
</div>

<nav class="top-nav">
  
  <a href="docs.html" class="active">Docs</a>
  
  <a href="download.html">Download</a>
  
  <a href="project.html">Project</a>
  
  <a href="community.html">Community</a>
  
  <a href="learning.html">Learning</a>
  
</nav>

<div class="top-search">
  <div id="search"></div>
</div>

<script type="text/javascript">
  Elm.Main.init({
    node: document.getElementById('search')
  });
</script>

    <div class="page-nav">
      







  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        
        <span class="section-number">1</span>
        
        
  <a href="docs.html"  class="active">Docs</a>

      </div>

      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="right">1.1&nbsp;</td>
            
            <td class="title-cell">
  <a href="install.html" >Install</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.2&nbsp;</td>
            
            <td class="title-cell">
  <a href="auth.html" >Auth &amp; Teams</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.3&nbsp;</td>
            
            <td class="title-cell">
  <a href="fly.html" >The <code>fly</code> CLI</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.4&nbsp;</td>
            
            <td class="title-cell">
  <a href="pipelines.html" >Pipelines</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.5&nbsp;</td>
            
            <td class="title-cell">
  <a href="resources.html" >Resources</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.6&nbsp;</td>
            
            <td class="title-cell">
  <a href="jobs.html" >Jobs</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.7&nbsp;</td>
            
            <td class="title-cell">
  <a href="tasks.html" >Tasks</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.8&nbsp;</td>
            
            <td class="title-cell">
  <a href="builds.html" >Builds</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.9&nbsp;</td>
            
            <td class="title-cell">
  <a href="operation.html"  class="active">Operation</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        
        <span class="section-number">1.9</span>
        
        
  <a href="operation.html"  class="active">Operation</a>

      </div>

      <div class="children">
        <table>
        
          <tr>
            
              <td class="number-cell" align="right">1.9.1&nbsp;</td>
            
            <td class="title-cell">
  <a href="encryption.html" >Encryption</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.9.2&nbsp;</td>
            
            <td class="title-cell">
  <a href="creds.html" >Credential Management</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.9.3&nbsp;</td>
            
            <td class="title-cell">
  <a href="metrics.html" >Metrics</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.9.4&nbsp;</td>
            
            <td class="title-cell">
  <a href="container-placement.html" >Container Placement</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.9.5&nbsp;</td>
            
            <td class="title-cell">
  <a href="global-resources.html"  class="self">Global Resources (experimental)</a>
</td>
          </tr>
        
          <tr>
            
              <td class="number-cell" align="right">1.9.6&nbsp;</td>
            
            <td class="title-cell">
  <a href="administration.html" >Administration</a>
</td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  





<div class="context">
  <div class="page-toc">
    <nav>
      <div class="top">
        
        <span class="section-number">1.9.5</span>
        
        
  <a href="global-resources.html"  class="self">Global Resources (experimental)</a>

      </div>

      
<div class="children">
  <table>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="global-resources.html#benefits-of-global-resources">Benefits of Global Resources</a>

          
        </td>
      </tr>
    
      <tr>
        
          <td class="number-cell" align="left"></td>
        
        <td class="title-cell">
          <a href="global-resources.html#risks-and-side-effects">Risks and Side Effects</a>

          
        </td>
      </tr>
    
  </table>
</div>

    </nav>
  </div>
</div>




    </div>

    <div class="page-aside"></div>

    <div class="page-content">
      <div class="section" id="section_global-resources">
  
  <h1 class="section-header"><a class="anchor" name="global-resources" href="#global-resources"></a><span class="section-number">1.9.5 </span>Global Resources (experimental)</h1>
  

  <p>Concourse v5.0 contains an experimental feature known as &#34;global resources&#34;. It is enabled by passing the <code>--enable-global-resources</code> flag to the <code>concourse web</code> command.</p><p>The basic concept of global resources is to share detected resource versions between all resources that have the same <a href="resources.html#resource-type"><code><strong>type</strong></code></a> and <a href="resources.html#resource-source"><code><strong>source</strong></code></a> configuration.</p><p>Before v5.0.0, each pipeline resource had its own version history, associated to the resource by name. This meant that multiple pipelines with the same resource configs would redundantly collect the same version and metadata information.</p><p>With v5.0.0&#39;s experimental &#39;global resources&#39; feature, resource versions are instead associated to an anonymous &#39;resource config&#39; i.e. its <a href="resources.html#resource-type"><code><strong>type</strong></code></a> and <a href="resources.html#resource-source"><code><strong>source</strong></code></a>.</p>

  
    
      <div class="section" id="section_benefits-of-global-resources">
  
  <h2 class="section-header"><a class="anchor" name="benefits-of-global-resources" href="#benefits-of-global-resources"></a>Benefits of Global Resources</h2>
  

  

  
    
      <div class="section" id="section_fewer-resource-checks-to-perform">
  
  <h3 class="section-header"><a class="anchor" name="fewer-resource-checks-to-perform" href="#fewer-resource-checks-to-perform"></a>Fewer resource <code>check</code>s to perform</h3>
  

  <p>With global resources, all resources that have the same configuration will share the same version history and share only one checking interval. This reduces load on the worker and on the external services that the resources point to.</p><p>For example, prior to global resources if there were three resources with the same configuration between three team&#39;s pipelines it would result in three check containers performing three resource checks every minute to fetch the versions.</p><p>With global resources, this configuration will result in only one check container and one resource check every minute to fetch versions for all the resources.</p><p>Since there will be only one resource check for all resources that have the same configuration, the resource that has the shortest <a href="resources.html#resource-check-every"><code><strong>check_every</strong></code></a> configured will result in its pipeline running the checks for that resource configuration.</p>

  
    
      <div class="section" id="section_complications-with-reusing-containers">
  
  <h4 class="section-header"><a class="anchor" name="complications-with-reusing-containers" href="#complications-with-reusing-containers"></a>Complications with reusing containers</h4>
  

  <p>There is an exception to sharing check containers within a deployment, which is workers belonging to a team and workers with tags.</p><p>If a resource has <a href="resources.html#resource-tags"><code><strong>tags</strong></code></a> configured, <em>and</em> the resource&#39;s check interval ends up acquiring the checking lock, a new container will be created on a worker matching the appropriate tags, even if a check container already exists for the same resource config elsewhere.</p><p>Similarly, if a team has its own workers, and their check interval ended up acquiring the lock, a new container will be created on the team&#39;s workers, rather than re-using a container from the shared worker pool.</p><p>This is a bit complicated to reason about and we plan to stop re-using <code>check</code> containers to simplify all of this. See <a href="http://github.com/concourse/concourse/issues/3079"><strong>concourse #3079</strong></a> for more information.</p>

  
    
  
</div>
    
  
</div>
    
      <div class="section" id="section_reducing-redundant-data">
  
  <h3 class="section-header"><a class="anchor" name="reducing-redundant-data" href="#reducing-redundant-data"></a>Reducing redundant data</h3>
  

  <p>The majority of Concourse resources will benefit from having versions shared globally because most resource versions have an external source of truth.</p><p>For example, a <code>check</code> for the <a href="http://github.com/concourse/git-resource"><code>git</code> resource</a> that pulls in the <code>concourse/concourse</code> repository will always return the same set of versions as an equivalent resource pointing to the same repository. By consolidating the <code>check</code>s and the versions, there will essentially only be one set of versions collected from the repository and saved into the database.</p>

  
    
  
</div>
    
      <div class="section" id="section_reliable-resource-version-history">
  
  <h3 class="section-header"><a class="anchor" name="reliable-resource-version-history" href="#reliable-resource-version-history"></a>Reliable Resource Version History</h3>
  

  <p>Prior to global resources, a resource&#39;s version history was directly associated to the resource name. This meant that any changes to a resource&#39;s configuration without changing its name would basically append the versions from the new configuration after the old versions, which are no longer accurate to the current configuration.</p><p>Global resources instead associates the resource versions to the resource&#39;s <a href="resources.html#resource-type"><code><strong>type</strong></code></a> and <a href="resources.html#resource-source"><code><strong>source</strong></code></a>. Therefore, whenever a resource definition changes, the versions will &#34;reset&#34; and change along with it, resulting in truthful and reliable version histories.</p>

  
    
  
</div>
    
  
</div>
    
      <div class="section" id="section_risks-and-side-effects">
  
  <h2 class="section-header"><a class="anchor" name="risks-and-side-effects" href="#risks-and-side-effects"></a>Risks and Side Effects</h2>
  

  

  
    
      <div class="section" id="section_some-resources-should-opt-out">
  
  <h3 class="section-header"><a class="anchor" name="some-resources-should-opt-out" href="#some-resources-should-opt-out"></a>Some resources should opt-out</h3>
  

  <p>Sharing versions isn&#39;t always a good idea. For example, the <a href="http://github.com/concourse/time-resource"><code>time</code> resource</a> is often used to generate versions on an interval so that jobs can fire periodically. If version history were to be shared for all users with e.g. a 10 minute interval, that would lead to a thundering herd of builds storming your workers, leading to load spikes and a lot of unhappy builds.</p><p>For this reason, resource types can opt out of sharing version history for all resources that use them. This way all existing usage of the <a href="http://github.com/concourse/time-resource"><code>time</code> resource</a> don&#39;t have to change, and continue to have their own version history, unique to the pipeline resource.</p><p>The <a href="http://github.com/concourse/time-resource"><code>time</code> resource</a> opts out of this by configuring <code>unique_version_history: true</code> in its <code>metadata.json</code> - but this is something that only &#34;core&#34; resource types can do. We plan on supporting this as part of the <a href="https://github.com/concourse/rfcs/pull/1">Resources v2 RFC</a>.</p><p>Users can also set this value themselves by configuring <a href="resource-types.html#resource-type-unique-version-history"><code><strong>unique_version_history</strong></code></a> on the resource type.</p><p>Another case where version history shouldn&#39;t be shared is when resources &#34;automagically&#34; learn their auth credentials using things like IAM roles. In these cases, the credentials aren&#39;t in the <a href="resources.html#resource-source"><code><strong>source</strong></code></a>. If version history were to be shared, anyone could configure the same <code>source:</code>, not specifying any credentials, and see the version history discovered by some other pipeline that ran its checks on workers that had access via IAM roles.</p><p>For this reason, any resource types that acquire credentials outside of <code>source:</code> should not share version history. Granted, the user won&#39;t be able to <em>fetch</em> these versions, but it&#39;s still an information leak.</p><p>IAM roles are a bit of a thorn in our side when it comes to designing features like this. We&#39;re planning on introducing support for them in a way that doesn&#39;t have this problem in <a href="http://github.com/concourse/concourse/issues/3023"><strong>concourse #3023</strong></a>.</p>

  
    
  
</div>
    
      <div class="section" id="section_intercept-admin-only">
  
  <h3 class="section-header"><a class="anchor" name="intercept-admin-only" href="#intercept-admin-only"></a>Intercepting <code>check</code> containers is no longer safe</h3>
  

  <p>Now that <code>check</code> containers are shared across teams, it would be dangerous to allow anyone to <a href="builds.html#fly-intercept"><code>fly intercept</code></a> to <code>check</code> containers. For this reason, this capability is limited to <a href="user-roles.html#concourse-admin">admin users</a>.</p><p>We recognize that this will make it a bit more difficult for end users to debug things like failing checks. We plan to improve this by introducing a way to provision a <em>new</em> <code>check</code> container to facilitate debugging. See <a href="http://github.com/concourse/concourse/issues/3344"><strong>concourse #3344</strong></a> for more information.</p>

  
    
  
</div>
    
  
</div>
    
  
</div>

      <nav class="prev-next">
      
        <div class="prev">
          prev:

          
          <span class="section-number">1.9.4</span>
          

          <a href="container-placement.html">Container Placement</a>
        </div>
      

      
        <div class="next">
          next:

          
          <span class="section-number">1.9.6</span>
          

          <a href="administration.html">Administration</a>
        </div>
      
      </nav>
    </div>

    <ul class="improve-docs">
      <li><img src="images/github.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>